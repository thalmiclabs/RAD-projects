/**
 * Copyright 2015 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * Busy Arm Detection
 */
Myo.options.armbusy_threshold = Myo.options.armbusy_threshold || 80;
Myo.armBusyData = 0;
Myo.on('gyroscope', function(gyro){
	this.armBusyData = this.armBusyData || 0;
	var ema_alpha = 0.05;
	var ema = this.armBusyData + ema_alpha * (Math.abs(gyro.x) + Math.abs(gyro.y) + Math.abs(gyro.z) - this.armBusyData);
	var busy = ema > this.options.armbusy_threshold;
	if(busy !== this.armIsBusy){
		this.trigger(busy ? 'arm_busy' : 'arm_rest');
	}
	this.armIsBusy = busy;
	this.armBusyData = ema;
});