/**
 * Copyright 2015 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * Double Tap
 *
 * requires myo.busyarm.js
 */
Myo.options.doubleTap = Myo.options.doubleTap || {};
Myo.options.doubleTap.time = Myo.options.doubleTap.time || [80, 300];
Myo.options.doubleTap.threshold = Myo.options.doubleTap.threshold || 0.9;
Myo.on('accelerometer', function(data){
	var last = this.lastIMU.accelerometer
	var y = Math.abs(data.y)
	var z = Math.abs(data.z)
	var delta = Math.abs(Math.abs(last.y) - y) + Math.abs(Math.abs(last.z) - z);

	if(delta > this.options.doubleTap.threshold){
		if(this.last_tap){
			var diff = new Date().getTime() - this.last_tap;
			if(diff > this.options.doubleTap.time[0] && diff < this.options.doubleTap.time[1] && !this.armIsBusy){
				this.trigger('double_tap');
			}
		}
		this.last_tap = new Date().getTime();
	}
});